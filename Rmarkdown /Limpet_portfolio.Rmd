---
title: "LImpet Growth Portfolio"
author: "Dylan Projansky"
date: "10/28/2017"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

2014 Limpet Growth Tracked: Jun 2014 to Jan 2015 

``` {r importfulldata, echo= FALSE}
# Prepare library for reading xlsx file 
library(readxl)

setwd("~/Desktop/San Jose State University /Research/Limpet_Growth")

df= read_xlsx("HMS_2014_limpet_growth_master_20171018.xlsx")
```

``` {r preparelimpet, echo= FALSE}
# Combine the Tag color and Tag number for each month 
df$Tag.color = paste(df$Tag.color, df$Tag.number.Jun, sep= '')
df$Tag.color__1 = paste(df$Tag.color__1, df$Tag.number.Jul, sep= '')
df$Tag.color__2= paste(df$Tag.color__2, df$Tag.number.Aug, sep = '')
df$Tag.color__3= paste(df$Tag.color__3, df$Tag.number.Sep, sep= '')
df$Tag.color__4= paste(df$Tag.color__4, df$Tag.number.Oct, sep= '')
df$Tag.color__5= paste(df$Tag.color__5, df$Tag.number.Nov, sep= '')
df$Tag.color__6= paste(df$Tag.color__6, df$Tag.number.Dec, sep= '')
df$Tag.color__7= paste(df$Tag.color__7, df$Tag.number.Jan, sep = '')

limpet= subset(df, select = c (2:5, 9, 16:18, 21, 24, 31, 34:36, 39, 42, 49,                              52:54, 57, 60, 67, 70:72, 75, 78, 85, 88:90, 93, 
                            96, 103, 106:108, 111, 114, 121, 124:126, 129, 
                            132, 139)) 

# Rename the Tag headers from Tag.color to Tag.Month 
colnames(limpet)[4]= 'Tag.Jun'
colnames(limpet)[8]= 'Tag.Jul'
colnames(limpet)[14]= 'Tag.Aug'
colnames(limpet)[20]= 'Tag.Sep'
colnames(limpet)[26]= 'Tag.Oct'
colnames(limpet)[32]= 'Tag.Nov'
colnames(limpet)[38]= 'Tag.Dec'
colnames(limpet)[44]= 'Tag.Jan'

# Convert all of the Areas into numeric values capable of determining the difference 
# between them 
limpet$AreaJun.mm2= as.numeric(limpet$AreaJun.mm2)
limpet$AreaJul.mm2= as.numeric(limpet$AreaJul.mm2)
limpet$AreaAug.mm2= as.numeric(limpet$AreaAug.mm2)
limpet$AreaSep.mm2= as.numeric(limpet$AreaSep.mm2)
limpet$AreaOct.mm2= as.numeric(limpet$AreaOct.mm2)
limpet$AreaNov.mm2= as.numeric(limpet$AreaNov.mm2)
limpet$AreaDec.mm2= as.numeric(limpet$AreaDec.mm2)
limpet$AreaJan.mm2= as.numeric(limpet$AreaJan.mm2)

# Convert the dates to month-year format 
limpet$Date= as.Date.character(limpet$Date, "%Y%m%d" )
limpet$Date2= as.Date.character(limpet$Date2, "%Y%m%d" )
limpet$Date3= as.Date.character(limpet$Date3, "%Y%m%d" )
limpet$Date4= as.Date.character(limpet$Date4, "%Y%m%d" )
limpet$Date5= as.Date.character(limpet$Date5, "%Y%m%d" )
limpet$Date6= as.Date.character(limpet$Date6, "%Y%m%d" )
limpet$Date7= as.Date.character(limpet$Date7, "%Y%m%d" )
limpet$Date8= as.Date.character(limpet$Date8, "%Y%m%d" )

```

``` {r limpetfunction}
limpet.function= function(plate, month1, month2){
  
  temp= as.data.frame(limpet[limpet$Plate == plate,])
  
  startMonth= paste('Area', month1, '.mm2', sep= '' )
  
  endMonth= paste('Area', month2, '.mm2', sep = '')
  
  tagMonth= paste('Tag.', month1, sep = '')
  
  replacementMonth= paste('Replacement', month2, sep = '')
  
  temp$diff= temp[, endMonth] -  temp[, startMonth]
  
  as.character(temp[, replacementMonth])
  
  temp$diff[temp[,replacementMonth] == TRUE]= NA
  
  # Check for replacement 
  # if (temp[,replacementMonth == TRUE]){
  #   temp$diff = NA} 
  
  temp= temp[!is.na(temp$diff),]
  
  plot(x= temp$Plate, y= temp$diff, xlim = c(plate - 2, plate + 2) )
  text(x= temp$Plate, y=temp$diff, 
       labels = temp[, tagMonth],
       cex=0.7, pos = 4)
  abline(b= 0, h= 5, col= "red")
  abline(b=0, h= -5, col= "red")
                                  
}
``` 
The above function creates a plot of the difference between two months, and plots the tag color and number next to the point. Lines are added at the growth mark of ±5mm2. This number was chosen as an estimate of an acceptable amount of area to be gained or lost. Growth within these red lines is assumed to be accepted. 

``` {r plate1_W5}

limpet.function(1, "Aug", "Sep")
# W5 is partially covered by another limpet in September
limpet.function(1, "Sep", "Oct")
limpet.function(1, "Oct", "Nov")
# W5 might have been replaced from October to November 
# Coloration in pictures look slightly different 

```

The limpets of plate 2 all maintained a growth of ±5 mm2 per month 

``` {r plate3_Or68}

limpet.function(3, "Nov", "Dec")
limpet.function(3, "Dec", "Jan")

# Or68 growth: Nov (62.83), Dec(86.67), Jan(62.94)
# Believe that the measurement in December is incorrect 
# Change in growth from Nov to December is 0.11 

```

The limpets of plate 7 all maintained a growth of ±5 mm2 per month 


``` {r plate8}

limpet.function(8, "Jun", "Jul")
# W19 increases by about 7 
# Change seems to be due to bag angle in Jun of W19 

limpet.function(8, "Jul", "Aug")
# Or47 increases by about 6 
# This growth may be accurate

```

The limpets of plate 9 all maintained a growth of ±5 mm2 per month 

``` {r plate10}

limpet.function(10, "Aug", "Sep")
# B78 looks like the same mussel and may have grown an accurate ammount 
limpet.function(10, "Sep", "Oct")
# B78 looks like the same mussel and may have grown an accurate ammount 
limpet.function(10, "Nov", "Dec")
# Or22 becomes Or56. Looks like the same mussel with new tag, but not 100% 
# W32 also becomes W63 from Nov to Dec 

```

``` {r plate11}

limpet.function(11, "Jun", "Jul")
# W33 and Gr11
# Gr11 seems to be accurate and could be due to the camera angle 
# I believe W33 and W62 are not the same mussel 
limpet.function(11, "Sep", "Oct")
# W62 and Or62 both have a difference of ±40
# We flipped the W62 and Or62 placement in the Excell file


```

``` {r plate12}
limpet.function(12, "Jun", "Jul")
# Or19: camera angle? 
# B64: camera angle? 
limpet.function(12, "Aug", "Sep")
# Gr7: camera angle? 
limpet.function(12, "Oct", "Nov")
# W87 is partially covered in October and then is alone in November 
```

``` {r plate16}
limpet.function(16, "Jul", "Aug")
# Or28, Or26, Gr57 
# All appear accurate with some variance to camera angle and overlap 
limpet.function(16, "Aug", "Sep")
# B88: overlap in September  
limpet.function(16, "Dec", "Jan")
# Or16: overlap in December  
```

``` {r plate17}
limpet.function(17, "Nov", "Dec")
# Or27: heavily chipped in November, seems accurate 
``` 

``` {r plate18}
limpet.function(18, "Jul", "Aug")
limpet.function(18, "Aug", "Sep")
limpet.function(18, "Sep", "Oct")
limpet.function(18, "Oct", "Nov")
limpet.function(18, "Nov", "Dec")


```
The large growth of plate 18 limpets may be due to human errors of camera angle or calculating the mm2, but the limpet measurements appear reasonalbe 

``` {r plate19}
limpet.function(19, "Aug", "Sep")
# W47: possible error in human measurements 
```

``` {r plate20}
limpet.function(20, "Aug", "Sep")
# Or34: Sep measurement may be low 
limpet.function(20, "Sep", "Oct")
# Or82: chipped in October 
limpet.function(20, "Dec", "Jan")
# W57: appears to be accurate in pictures 

``` 

``` {r plate21} 
limpet.function(21, "Jul", "Aug")
# Gr28: camera angle? 
limpet.function(21, "Nov", "Dec")
# B6: camera angle and some overlap in December 

```

``` {r plate22}
limpet.function(22, "Jul", "Aug")
# Gr66 
limpet.function(22, "Aug", "Sep")
# Gr66 
limpet.function(22, "Oct", "Nov")
# Gr66
```

Gr66 appears to have significant growth throughout the 6 months. Some camera angles may alter the observed growth 

``` {r plate23} 
limpet.function(23, "Jul", "Aug")
# B61 
limpet.function(23, "Aug", "Sep")
# B61 
limpet.function(23, "Sep", "Oct")
# B61 and W36 
limpet.function(23, "Oct", "Nov")
# B61 and W36 
limpet.function(23, "Dec", "Jan")
# Or3, W36, B61, Gr78

```

Plate 23 seems to be an outlier in comparison to the other plates. It appears that this plate has much higher growth than other plates, specifically B61. There is a noticable difference from the start of B61 in Jul to Jan. It is possible that there is an error in measurements and it might be advisable to redue the measurements for this plate all the way through. 

``` {r plate24} 
limpet.function(24, "Jul", "Aug")
# B62 and Or90
# Or90 may be due to camera angle 
limpet.function(24, "Sep", "Oct")
# B62: camera angle + growth 
limpet.function(24, "Oct", "Nov")
# Or90 and B62 

```

The function below is a direct addition to the previous function which plots one plate growth between two consecutive months. This function plots three plates' growth between consectuive months. The function is capable of plotting any plates, but graphs best when the plate numbers are close together, example: 7, 8, 9. Like above, the months are three letter abbreviations and are written in quotation marks, example: July = "Jul", November = "Nov". 
``` {r 3platefunction} 
three.plate= function(plate1, plate2, plate3, month1, month2){
  
  temp1= as.data.frame(limpet[limpet$Plate == plate1,])
  temp2= as.data.frame(limpet[limpet$Plate == plate2,])
  temp3= as.data.frame(limpet[limpet$Plate == plate3,])
  temp= rbind(temp1, temp2, temp3)
  
  startMonth= paste('Area', month1, '.mm2', sep= '' )
  
  endMonth= paste('Area', month2, '.mm2', sep = '')
  
  tagMonth= paste('Tag.', month1, sep = '')
  
  replacementMonth= paste('Replacement', month2, sep = '')
  
  temp$diff= temp[, endMonth] -  temp[, startMonth]
  
  as.character(temp[, replacementMonth])
  
  temp$diff[temp[,replacementMonth] == TRUE]= NA
  
  temp= temp[!is.na(temp$diff),]
  
  ymax= max(temp$diff, na.rm= TRUE)
  ymin= min(temp$diff, na.rm= TRUE) 
  
  plot(x= temp$Plate[temp$Plate == plate1], 
       y= temp$diff[temp$Plate == plate1], 
       col= "blue", pch= 1, 
       xlim = c(plate1 -3 , plate3 + 3), 
       ylim= c(ymin -2, ymax +2),
       xlab= "Plate Number", ylab= "Limpet Growth mm2")
  points(x= temp$Plate[temp$Plate == plate2], 
         y= temp$diff[temp$Plate == plate2], 
         col="red", pch= 2 )
  points(x= temp$Plate[temp$Plate == plate3], 
         y= temp$diff[temp$Plate == plate3], 
         col= "green",pch= 3 )
  text(x= temp$Plate, y=temp$diff, 
       labels = temp[, tagMonth],
       cex=0.7, pos = 4)
  abline(b= 0, h= 5, col= "red")
  abline(b=0, h= -5, col= "red")
  legend("topright", legend= c(plate1, plate2, plate3), 
         col = c("blue", "red", "green"), 
         pch = c(1, 2, 3), title = "Plate Number", cex = 0.75 ) 
                                  
}

``` 

``` {r five_plate_growth}

five.plate= function(plate1, plate2, plate3, plate4, plate5, month1, month2){
  
  temp1= as.data.frame(limpet[limpet$Plate == plate1,])
  temp2= as.data.frame(limpet[limpet$Plate == plate2,])
  temp3= as.data.frame(limpet[limpet$Plate == plate3,])
  temp4= as.data.frame(limpet[limpet$Plate == plate4,])
  temp5= as.data.frame(limpet[limpet$Plate == plate5,])
  temp= rbind(temp1, temp2, temp3, temp4, temp5)
  
  startMonth= paste('Area', month1, '.mm2', sep= '' )
  
  endMonth= paste('Area', month2, '.mm2', sep = '')
  
  tagMonth= paste('Tag.', month1, sep = '')
  
  replacementMonth= paste('Replacement', month2, sep = '')
  
  temp$diff= temp[, endMonth] -  temp[, startMonth]
  
  as.character(temp[, replacementMonth])
  
  temp$diff[temp[,replacementMonth] == TRUE]= NA
  
  temp= temp[!is.na(temp$diff),]
  
  ymax= max(temp$diff, na.rm= TRUE)
  ymin= min(temp$diff, na.rm= TRUE) 
  
  plot(x= temp$Plate[temp$Plate == plate1], 
       y= temp$diff[temp$Plate == plate1], 
       col= "blue", pch= 1, 
       xlim = c(plate1 -3 , plate3 + 3), 
       ylim= c(ymin -2, ymax +2),
       xlab= "Plate Number", ylab= "Limpet Growth mm2")
  points(x= temp$Plate[temp$Plate == plate2], 
         y= temp$diff[temp$Plate == plate2], 
         col="red", pch= 2 )
  points(x= temp$Plate[temp$Plate == plate3], 
         y= temp$diff[temp$Plate == plate3], 
         col= "green",pch= 3 )
  points(x= temp$Plate[temp$Plate == plate4], 
         y= temp$diff[temp$Plate == plate4], 
         col= "orange",pch= 4 )
  points(x= temp$Plate[temp$Plate == plate5], 
         y= temp$diff[temp$Plate == plate5], 
         col= "black",pch= 5 )
  text(x= temp$Plate, y=temp$diff, 
       labels = temp[, tagMonth],
       cex=0.7, pos = 4)
  abline(b= 0, h= 5, col= "red")
  abline(b=0, h= -5, col= "red")
  legend("topright", legend= c(plate1, plate2, plate3, plate4, plate5), 
         col = c("blue", "red", "green", "orange", "black"), 
         pch = c(1, 2, 3, 4, 5), title = "Plate Number", cex = 0.75 ) 
                                  
}

``` 

``` {r dataframe_tracker}
tracker= function(plate1){
  data= as.data.frame(limpet[limpet$Plate == plate1,])
  data= subset(data, select= c(1:6, 8:12, 14:18, 20:24, 26:30, 32:36, 38:42,
                               44:47) )

  sub1= subset(data, select = c("Date2", "Tag.Jul", "ReplacementJul", "AreaJul.mm2", "GrowthJul.Area.mm2"))
  colnames(sub1)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub1$Num= 1:nrow(data)
  sub2= subset(data, select= c("Date3", "Tag.Aug", "ReplacementAug", "AreaAug.mm2", "GrowthAug.Area.mm2"))
  colnames(sub2)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub2$Num= 1:nrow(data)
  sub3= subset(data, select = c("Date3", "Tag.Sep", "ReplacementSep", "AreaSep.mm2","GrowthSep.Area.mm2"))
  colnames(sub3)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub3$Num= 1:nrow(data)
  sub4= subset(data, select = c("Date4", "Tag.Oct", "ReplacementOct", "AreaOct.mm2","GrowthOct.Area.mm2"))
  colnames(sub4)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub4$Num= 1:nrow(data)
  sub5= subset(data, select = c("Date5", "Tag.Nov", "ReplacementNov", "AreaNov.mm2","GrowthNov.Area.mm2"))
  colnames(sub5)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub5$Num= 1:nrow(data)
  sub6= subset(data, select = c("Date6", "Tag.Dec", "ReplacementDec", "AreaDec.mm2","GrowthDec.Area.mm2"))
  colnames(sub6)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub6$Num= 1:nrow(data)
  sub7= subset(data, select = c("Date7", "Tag.Jan", "ReplacementJan", "AreaJan.mm2","GrowthJan.Area.mm2"))
  colnames(sub7)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub7$Num= 1:nrow(data)
  
  longdata= rbind(sub1, sub2, sub3, sub4, sub5, sub6, sub7)
  
  # Clean-up 
  rm(sub1, sub2, sub3, sub4, sub5, sub6, sub7)
  
  longdata$Growth= as.numeric(longdata$Growth)
  
  for(i in 1:length(unique(longdata$Num)) ) {
    
    if(i == 1){
      plot(x= longdata$Date[longdata$Num == i], 
           y= longdata$Growth[longdata$Num == i], col= i, 
           xlab= "Months", ylab= "Growth mm2",
           ylim= c(min(longdata$Growth, na.rm= TRUE), max(longdata$Growth, na.rm = TRUE) ) )
      text(x= longdata$Date[longdata$Num == i], 
           y= longdata$Growth[longdata$Num == i], 
         labels = longdata[longdata$Num == i, "Tag"],
         cex=0.7, pos = 4)
    } else {
      points(x= longdata$Date[longdata$Num == i], 
             y= longdata$Growth[longdata$Num == i], col=i+1)
      text(x= longdata$Date[longdata$Num == i], 
           y= longdata$Growth[longdata$Num == i], 
         labels = longdata[longdata$Num == i, "Tag"],
         cex=0.7, pos = 4)
  }
  }  
  
  
for(i in 1:length(unique(longdata$Num)) ) {
    
    if(i == 1){  
      lines(x= longdata$Date[longdata$Num == i], 
           y= longdata$Growth[longdata$Num == i], col= i)
    } else {
      lines(x= longdata$Date[longdata$Num == i], 
             y= longdata$Growth[longdata$Num == i], col=i+1)
    }
}

}
```

```{r save_df}
dataframe= function(plate1){
  data= as.data.frame(limpet[limpet$Plate == plate1,])
  data= subset(data, select= c(1:6, 8:12, 14:18, 20:24, 26:30, 32:36, 38:42,
                               44:47) )

  sub1= subset(data, select = c("Date2", "Tag.Jul", "ReplacementJul", "AreaJul.mm2", "GrowthJul.Area.mm2"))
  colnames(sub1)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub1$Num= 1:nrow(data)
  sub2= subset(data, select= c("Date3", "Tag.Aug", "ReplacementAug", "AreaAug.mm2", "GrowthAug.Area.mm2"))
  colnames(sub2)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub2$Num= 1:nrow(data)
  sub3= subset(data, select = c("Date3", "Tag.Sep", "ReplacementSep", "AreaSep.mm2","GrowthSep.Area.mm2"))
  colnames(sub3)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub3$Num= 1:nrow(data)
  sub4= subset(data, select = c("Date4", "Tag.Oct", "ReplacementOct", "AreaOct.mm2","GrowthOct.Area.mm2"))
  colnames(sub4)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub4$Num= 1:nrow(data)
  sub5= subset(data, select = c("Date5", "Tag.Nov", "ReplacementNov", "AreaNov.mm2","GrowthNov.Area.mm2"))
  colnames(sub5)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub5$Num= 1:nrow(data)
  sub6= subset(data, select = c("Date6", "Tag.Dec", "ReplacementDec", "AreaDec.mm2","GrowthDec.Area.mm2"))
  colnames(sub6)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub6$Num= 1:nrow(data)
  sub7= subset(data, select = c("Date7", "Tag.Jan", "ReplacementJan", "AreaJan.mm2","GrowthJan.Area.mm2"))
  colnames(sub7)= c("Date", "Tag", "Replacement", "Area", "Growth")
  sub7$Num= 1:nrow(data)
  
  longdata= rbind(sub1, sub2, sub3, sub4, sub5, sub6, sub7)
  
  # Clean-up 
  rm(sub1, sub2, sub3, sub4, sub5, sub6, sub7)
  
  longdata$Growth= as.numeric(longdata$Growth)
  
  filename= paste("limpet_growth_plate", plate1, ".csv", sep = '')
  write.csv(longdata, file = filename )

}
``` 